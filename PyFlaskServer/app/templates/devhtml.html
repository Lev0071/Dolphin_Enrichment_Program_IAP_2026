<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Layout</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesDEV.css') }}">


    <script>
        function updateButtonColors() {
            const buttons = document.querySelectorAll('.connected_button');
            buttons.forEach(button => {
                fetch(`/update_button_colour/${button.id.slice(-1)}`)
                    .then(response => response.json())
                    .then(data => {
                        button.style.backgroundColor = data.new_color;
                    });
            });
        }

        // Update button colors every 5. seconds
        setInterval(updateButtonColors, 500);

        // Initial call to set colors when the page loads
        window.onload = updateButtonColors;
    </script>

    
</head>
<body>
    
    <div class="container">
        
        <div class="header">
            <div class="tab">Home tab</div>
            <div class="tab">Joystick tab</div>

        </div>
        
        <div class="main-content">
            
            <div class="left-panel">

                <div class="logos">
                    <img class="logo" src="/static/griffith-logo.jpg" width="200" height="200">
                    <img class="logo" src="/static/SeaWorld.jpg" width="300" height="200">
                </div>

        <form action="{{url_for('reboot_rasberry_pi_flask_route')}}">
            <button class="button"> Restart Raspberry Pi</button>
        </form>

    <form action="{{url_for('reset_buttons_flask_route')}}">
        <button class="button"> Reset Buttons</button>
    </form>
            
    <form action="{{url_for('restart_program_flask_route')}}">

        <button class="button"> Restart Program</button>

    </form>
                
      <form action="{{url_for('shutdown_system_flask_route')}}">  
        <button class="button"> Shutdown System</button>

    </form>
    
        </form>
                
      <form action="{{url_for('scan_button_pressed_flask')}}">  
        <button class="button"> Scan for buttons</button>

    </form>
            </div>


            
            <div class="keypad">

                <form action="{{ url_for('button_click_server',button_id=0)}}" method="POST"> <button class="connected_button" id="button1">1</button></form>
                <form action="{{ url_for('button_click_server',button_id=1)}}" method="POST"> <button class="connected_button" id="button2">2</button></form>
                <form action="{{ url_for('button_click_server',button_id=2)}}" method="POST"> <button class="connected_button" id="button3">3</button></form>
                <form action="{{ url_for('button_click_server',button_id=3)}}" method="POST"> <button class="connected_button" id="button4">4</button></form>
                <button class="toggle_button" id="s1">Simulate b1</button>
                <button class="toggle_button" id="s2">Simulate b2</button>
                <button class="toggle_button" id="s3">Simulate b3</button>
                <button class="toggle_button" id="s4">Simulate b4</button>

<script>
    function setupButton(interactivebutton, arduinobutton) {
        const button = document.getElementById(interactivebutton);
        const square = document.getElementById(arduinobutton);

        button.addEventListener('mousedown', () => {

            startSimulatingButton(interactivebutton.replace('button', ''));
            
        });

        button.addEventListener('mouseup', () => {

            stopSimulatingButton(interactivebutton.replace('button', ''));
        });
    }

    // Initialize buttons and squares
    setupButton('s1', 'button1');
    setupButton('s2', 'button2');
    setupButton('s3', 'button3');
    setupButton('s4','button4')

    function startSimulatingButton(buttonId) {
        let formData = new FormData();
        fetch(`/start_simulate_press/${buttonId}`, { method: 'POST' })
                        .then(response => response)
                        .then(data => {
                            
                        });
                
    }
    function stopSimulatingButton(buttonId){
        let formData = new FormData();


        fetch(`/stop_simulate_press/${buttonId}`, { method: 'POST' })
                .then(response => response)
                .then(data => {
                    
                });
    }
</script>
            </div>



            <div class="console">

                <div id="message"> </div>
                <script type="text/javascript">
                    
                    if(typeof(EventSource)!=="undefined"){
                    var source = new EventSource("/stream")
                    
                    source.onmessage=function(event){
                        var message=document.getElementById("message")
                        message.innerHTML=event.data
                    };
                }else{
                    console.log("Your browser doesn't support SSE")
                }
                    
                </script>
            </div>
        </div>
        <div class="lower-content">
            <div class="left-settings">
                <div class="control-row">
                    Hose Override Active:
                    <input type="text" readonly="readonly" value={{serverdata.hose_override}}>
                    <form action="{{url_for('toggle_override')}}" method="POST"><button class="button">Toggle</button></form>

                </div>

                <div class="control-row">
                    Hose Time (seconds):
                    <form action="{{url_for('change_hose_time_flask_route')}}" method="POST">                     
                        <input type="number" id="hose_time" name="hose_time" value={{serverdata.hose_time}}>
                        <button class="button" type="submit">Set</button>
                     </form>
                </div>

                <div class="game-controls">
                    <div class="control-row">
                       Random Game Active: 
                        <input type="text" readonly="readonly" value={{serverdata.game_status}}>
                    </div>
                    <div class="control-row">
                        <button href="/start_random_game" class="button"> Start </button>
                        <button href="/stop_random_game" class="button"> Stop </button>
                    </div>

                    <div class="control-row">
                        Co-Op Button Time Window (Seconds)
                        <form action="{{url_for('change_coop_button_time')}}" method="POST">  
                        <input type="number" id="coop_button_time" name="coop_button_time" value={{serverdata.coop_button_time}}>
                        <button class="button" >Set</button>
                    </form>
                    </div>
                    <div class="control-row">
                        Co-Op Game Active:
                        <input type="text" readonly="readonly" value={{serverdata.coop_game_status}}>
                    </div>
                    <div class="control-row">
                        <button href="/start_coop_game" class="button"> Start </button>
                        <button href="/stop_coop_game" class="button"> Stop </button>
                    </div>
                </div>

            </div>

        </div>
    </div>
</body>
</html>
